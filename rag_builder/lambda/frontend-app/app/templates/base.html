<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.slate.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.colors.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>
    <script type="module" src="https://md-block.verou.me/md-block.js"></script>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        display: flex;
        flex-direction: column;
      }
      main {
        flex: 1 0 auto;
      }
      header,
      footer {
        flex-shrink: 0;
      }
      a {
        text-decoration: none;
      }
      aside {
        background-color: var(--pico-color-slate-600);
        padding: var(--pico-spacing);
        border-radius: var(--pico-border-radius);
      }
      .sidebar-header {
        font-size: 1.1em;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      .hero {
        text-align: center;
        padding: 3rem 0;
      }
    </style>
    <title>RAG Builder</title>
  </head>
  <body>
    <header class="container">
      <nav>
        <ul>
          <li>
            <a href="/frontend" style="text-decoration: none">
              <strong>üìö RAG Builder</strong>
            </a>
          </li>
        </ul>
        {% if request.session.email %}
        <ul>
          <li>
            <details role="list" class="dropdown">
              <summary aria-haspopup="listbox" role="button">üßë</summary>
              <ul role="listbox">
                <li><small>Hi, {{ request.session.email }}!</small></li>
                <li>
                  <a href="/auth/logout">Logout</a>
                </li>
              </ul>
            </details>
          </li>
        </ul>
        {% endif %}
      </nav>
    </header>
    <main class="container">
      {% block main %}
      <div class="grid" style="grid-template-columns: 1fr 3fr">
        <aside>
          <nav>
            <ul>
              <li>
                <div class="sidebar-header">üìö Knowledge Base</div>
                <ul>
                  <li>
                    <a
                      href="#"
                      hx-get="/frontend/knowledge-base/available-documents"
                      hx-target="#content"
                      >üìÑ Available Documents</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      hx-get="/frontend/knowledge-base/query"
                      hx-target="#content"
                      >‚ùì Query</a
                    >
                  </li>
                </ul>
              </li>
              <li>
                <div class="sidebar-header">üì• Load Document</div>
                <ul>
                  <li>
                    <a
                      href="#"
                      hx-get="/frontend/load-document/new-document"
                      hx-target="#content"
                      >‚ûï New Document</a
                    >
                  </li>
                  <li>
                    <a
                      href="#"
                      hx-get="/frontend/load-document/load-history"
                      hx-target="#content"
                      >üìú Load History</a
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </nav>
        </aside>
        <section id="content">{% block content %}{% endblock %}</section>
      </div>
      {% endblock %}
    </main>
    <footer class="container" style="text-align: center">
      <small
        >Created by <a href="https://github.com/gontzalm">gontzalm</a> | Source
        code in <a href="https://github.com/gontzalm/rag-builder">GitHub</a> |
        Powered by Pico ‚ú®</small
      >
    </footer>
    <dialog id="confirmation-modal">
      <article>
        <header>
          <button class="close" aria-label="Close" data-modal-close></button>
          <h3 data-modal-title></h3>
        </header>
        <p data-modal-body></p>
        <footer>
          <button class="secondary" data-modal-close>Cancel</button>
          <button data-modal-confirm>Confirm</button>
        </footer>
      </article>
    </dialog>

    <script>
      (() => {
        const openModal = (modal) => modal.showModal();
        const closeModal = (modal) => modal.close();

        document.addEventListener("click", (event) => {
          const trigger = event.target.closest("[data-modal-trigger]");
          if (trigger) {
            event.preventDefault(); // Prevent default button action
            event.stopPropagation(); // Stop the event from bubbling up to other listeners
            const modalId = trigger.dataset.modalTrigger;
            const modal = document.getElementById(modalId);
            if (!modal) return;

            // Content
            const title = trigger.dataset.modalTitle;
            const body = trigger.dataset.modalBody;
            if (title)
              modal.querySelector("[data-modal-title]").textContent = title;
            if (body) modal.querySelector("[data-modal-body]").innerHTML = body;

            // Footer visibility
            const footer = modal.querySelector("footer");
            if (footer) {
              if (trigger.dataset.modalHideFooter === "true") {
                footer.style.display = "none";
              } else {
                footer.style.display = "block";
              }
            }

            // Confirm button htmx attributes
            const confirmBtn = modal.querySelector("[data-modal-confirm]");
            if (confirmBtn) {
              // Clear existing hx-* attributes from confirm button
              for (const attr of [...confirmBtn.attributes]) {
                if (attr.name.startsWith("hx-")) {
                  confirmBtn.removeAttribute(attr.name);
                }
              }

              // Copy modal-hx-* attributes from trigger to hx-* on confirm button
              for (const attr of trigger.attributes) {
                if (attr.name.startsWith("modal-hx-")) {
                  confirmBtn.setAttribute(
                    attr.name.replace("modal-hx-", "hx-"),
                    attr.value,
                  );
                }
              }
              // Process the confirm button with htmx
              htmx.process(confirmBtn);

              // Add a one-time listener to close the modal after the htmx request completes
              confirmBtn.addEventListener(
                "htmx:afterRequest",
                () => {
                  closeModal(modal);
                },
                { once: true },
              );
            }

            openModal(modal);
            return;
          }

          const closer = event.target.closest("[data-modal-close]");
          if (closer) {
            const modal = closer.closest("dialog");
            if (modal) closeModal(modal);
            return;
          }
        });
      })();
    </script>
    {% block extra_scripts %}{% endblock %}
  </body>
</html>
